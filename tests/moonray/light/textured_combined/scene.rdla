rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["lights_visible_in_camera"] = true,
    ["image_width" ] = 256,
    ["image_height"] = 256,
}

Camera("/scene/camera") {
    ["node_xform"] = rotate(-2, 1, 0, 0) * translate(0.5, 4, 20, 1),
    ["focal"] = 45,
}

-------------------------------------------------------

widget = UsdGeometry("/scene/geometry/widget") {
    ["node_xform"] = scale(0.6, 0.6, 0.6) * translate(0, 0, 1),
    ["stage"] = rats_assets_dir.."/models/MoonRayWidget.usdc",
    ["prim_path"] = "/widget",
}

floor = UsdGeometry("/scene/geometry/floor") {
    ["node_xform"] = scale(20, 20, 20),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

wall = UsdGeometry("/scene/geometry/wall") {
    ["node_xform"] = scale(20, 1, 10) * rotate(90, 1, 0, 0) * translate(0, 5, -2.2),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

torus = UsdGeometry("/scene/geometry/torus") {
    ["node_xform"] = scale(0.5, 0.5, 0.5) * rotate(90, 0, 0, 1),
    ["stage"] = rats_assets_dir.."/models/torus.usdc",
    ["prim_path"] = "/torus",
}

GeometrySet("/scene/geometryset") {
    widget,
    floor,
    wall,
    torus,
}

-------------------------------------------------------

floor_material = DwaSolidDielectricMaterial("scene/materials/floor") {
    ["show_specular"] = false,
}

widget_material = DwaSolidDielectricMaterial("scene/materials/widget") {
    ["albedo"] = Rgb(0.5, 0.5, 0.5),
    ["roughness"] = 0.25,
}

imagemap = ImageMap("scene/imagemap") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

-------------------------------------------------------

local tx = 5    -- common x-translation performed before rotations
local ty = 3    -- common y-translation performed after rotations
local tz = 1    -- common z-translation performed after rotations
local ry = -5   -- small y-rotation to bring lights slightly in front of widget
local rz = 0    -- z-rotation of first light
local dr = 22.5 -- incremental z-rotation stepping from one light to the next

cylinderlight = CylinderLight("scene/lights/cylinderlight") {
    ["node_xform"] = translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+0*dr, 0, 0, 1) * translate(0, ty, tz),
    ["radius"] = 0.3,
    ["color"] = Rgb(1, 0.01, 0.01),
    ["intensity"] = 0.03,
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

spherelight = SphereLight("scene/lights/spherelight") {
    ["node_xform"] = translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+1*dr, 0, 0, 1) * translate(0, ty, tz),
    ["radius"] = 0.5,
    ["color"] = Rgb(1, 1, 0.01),
    ["intensity"] = 0.02,
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

disklight = DiskLight("scene/lights/disklight") {
    ["node_xform"] = rotate(90, 0, 1, 0) * translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+2*dr, 0, 0, 1) * translate(0, ty, tz),
    ["color"] = Rgb(0.01, 1, 0.01),
    ["intensity"] = 0.02,
    ["radius"] = 0.5,
    ["sidedness"] = 2,
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

rectlight = RectLight("scene/lights/rectlight") {
    ["node_xform"] = rotate(90, 0, 1, 0) * translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+3*dr, 0, 0, 1) * translate(0, ty, tz),
    ["color"] = Rgb(0.01, 1, 1),
    ["intensity"] = 0.02,
    ["sidedness"] = 2,
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

spotlight = SpotLight("scene/lights/spotlight") {
    ["node_xform"] = rotate(90, 0, 1, 0) * translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+4*dr, 0, 0, 1) * translate(0, ty, tz),
    ["color"] = Rgb(0.01, 0.01, 1),
    ["intensity"] = 0.02,
    ["black_level"] = 0.1,
    ["lens_radius"] = 0.5,
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

meshlight = MeshLight("scene/lights/meshlight") {
    ["node_xform"] = rotate(90, 0, 1, 0) * translate(tx, 0, 0) * rotate(ry, 0, 1, 0) * rotate(rz+5*dr, 0, 0, 1) * translate(0, ty, tz),
    ["geometry"] = torus,
    ["color"] = Rgb(1, 0.01, 1),
    ["intensity"] = 0.02,
    ["map_shader"] = imagemap,
}

lightset = LightSet("scene/lightset") {
    cylinderlight,
    spherelight,
    disklight,
    rectlight,
    spotlight,
    meshlight,
}

-------------------------------------------------------

Layer("/scene/rendering/organizer/perPartitionAssignments") {
    {widget, "", widget_material, lightset},
    {floor,  "", floor_material,  lightset},
    {wall,   "", floor_material,  lightset},
}

