rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["lights_visible_in_camera"] = true,
    ["pixel_samples"] = 2,
    ["max_depth"] = 0,
    ["image_width"] = 400,
    ["image_height"] = 400
}

Camera("/Scene/rendering/camera") {
	["node_xform"] = rotate(-10, 1, 0, 0) * translate(0, 5, 10),
}


-- Geometry --


local torus = UsdGeometry("/Scene/geometry/torus") {
    ["node_xform"] = scale(1.5, 1.5, 1.5) * translate(0, 1, 0),
    ["stage"] = rats_assets_dir.."/models/torus.usdc",
    ["prim_path"] = "/torus",
}

local floor = UsdGeometry("/Scene/geometry/floor") {
    ["node_xform"] = scale(20, 20, 20) * translate(0,0,0),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

local wall = UsdGeometry("/Scene/geometry/wall") {
    ["node_xform"] = Mat4(20, 0, 0, 0, 0, 0, 1, 0, 0, -10, 0, 0, 0, 5, -10, 1),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

GeometrySet("geometryset") {
    torus,
    floor,
    wall
}


-- Materials --


local floorMtl = DwaBaseMaterial("/Scene/surfacing/floor") {
    ["albedo"] = Rgb(1, 1, 1),
    ["roughness"] = 0.316228,
}


local torusMtl = DwaBaseMaterial("/Scene/surfacing/object_torus") {
    ["albedo"] = Rgb(0.2, 0.2, 0.2),
    ["roughness"] = 0.14,
}



-- Lights --


RectLight("/Scene/lighting/rect") {
    ["node_xform"] = Mat4(-1, 0, 0, 0,     0, 1, 0, 0,     0, 0, -1, 0,     -3.7, 1.3, -9.99, 1),
    ["color"] = Rgb(0.3, 1, 1),
    ["intensity"] = 1.5,
    ["normalized"] = false,
    ["width"] = 4,
    ["height"] = 2,
}

DiskLight("/Scene/lighting/disk") {
    ["node_xform"] = rotate(-38, 1, 0, 0) * translate(-2.8, 5, -8.7),
    ["color"] = Rgb(1, 1, 1),
    ["normalized"] = false,
    ["radius"] = 2,
    ["texture"] = rats_assets_dir.."/hdri/parkinglot_dusk.exr",
}

SphereLight("/Scene/lighting/sphere") {
    ["node_xform"] = Mat4(1, 0, 0, 0,     0, 1, 0, 0,     0, 0, 1, 0,     3, 5, -8.4, 1),
    ["normalized"] = false,
    ["radius"] = 2,
    ["intensity"] = 0.7,
    ["texture"] = rats_assets_dir.."/hdri/parkinglot_dusk.exr",
}

SpotLight("/Scene/lighting/spot") {
    ["node_xform"] = Mat4(-1, 0, 0, 0,     0, 1, 0, 0,     0, 0, -1, 0,     3.7, 1.1, -9.99, 1),
    ["color"] = Rgb(1, 0.5, 0.4),
    ["normalized"] = false,
    ["lens_radius"] = 2,
    ["inner_cone_angle"] = 10,
    ["outer_cone_angle"] = 120,
    ["aspect_ratio"] = 2.0,
    ["angle_falloff_type"] = 0,
}

DistantLight("/Scene/lighting/sun") {
    ["node_xform"] = Mat4(-0.0331935, 0, -0.999449, 0, -0.477948, 0.878244, 0.0158735, 0, 0.87776, 0.478212, -0.029152, 0, 19.1295, 13.3486, -7.11974, 1),
    ["intensity"] = 30,
    ["normalized"] = false,
    ["color"] = Rgb(0.749, 0.748, 0.678),
    ["angular_extent"] = 10,
}

EnvLight("/Scene/lighting/env") {
    ["node_xform"] = Mat4(1, 0, 0, 0,       0, 1, 0, 0,         0, 0, 1, 0,        0, 0, 0, 1),
    ["intensity"] = 0.2,
    ["color"] = Rgb(1, 1, 1),
    ["sample_upper_hemisphere_only"] = false,
    ["texture"] = rats_assets_dir.."/hdri/studio_3_point.exr",
}


-- these lights will only affect the wall and ground
LightSet("LightSetA") {
    SphereLight("/Scene/lighting/sphere"),
    RectLight("/Scene/lighting/rect"),
    SpotLight("/Scene/lighting/spot"),
}

-- these lights will only affect the torus
LightSet("LightSetB") {
    DiskLight("/Scene/lighting/disk"),
    EnvLight("/Scene/lighting/env"),
    DistantLight("/Scene/lighting/sun"),
}

Layer("/Scene/rendering/organizer/perPartitionAssignments") {
    {torus, "", torusMtl, LightSet("LightSetA")},
    {floor, "", floorMtl, LightSet("LightSetB")},
    {wall, "", floorMtl, LightSet("LightSetB")},
}
