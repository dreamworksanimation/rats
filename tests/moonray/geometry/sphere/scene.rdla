rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 256,
    ["image_height"] = 128,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = Mat4(0.996454, -0.0446502, -0.0713123, 0, 0.00540735, 0.879804, -0.475306, 0, 0.0839633, 0.473235, 0.876925, 0, 3.51943, 18.4177, 33.7106, 1),
    ["focal"] = 30,
    ["film_width_aperture"] = 24,
}

-------------------------------------------------------

sphere1 = SphereGeometry("/Scene/geometry/sphere1") {
    ["node_xform"] = rotate(120, 1, 0, 0) * rotate(10, 0, 0, 1) *translate(-6, 4, 6),
    ["radius"] = 4,
    ["zmin"] = -4,
    ["zmax"] = 4,
    ["phi_max"] = 360,
}

sphere2 = SphereGeometry("/Scene/geometry/sphere2") {
    ["node_xform"] = rotate(70, 0, 1, 0) * rotate(170, 1, 0, 0) * rotate(20, 0, 0, 1) * translate(6, 4, 6),
    ["radius"] = 4,
    ["zmin"] = -2,
    ["zmax"] = 3.8,
    ["phi_max"] = 180,
}

wall = RdlMeshGeometry("/Scene/geometry/wall") {
    ["node_xform"] = translate(0, 0, 0),
    ["vertex_list"] = {Vec3(-20,  20, -2), Vec3(-20,  0, -2), Vec3(-20,  0, 20),
                       Vec3(20,  0, 20), Vec3(20,  0, -2), Vec3(20,  20, -2)},
    ["vertices_by_index"] = {0, 1, 4, 5,
                             1, 2, 3, 4},
    ["face_vertex_count"] = {4, 4},
    ["is_subd"] = false,
    ["smooth_normal"] = false,
}

GeometrySet("geometryset") {
    sphere1,
    sphere2,
    wall
}

-------------------------------------------------------

map1 = ImageMap("/Scene/surfacing/map1") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

map2 = ImageMap("/Scene/surfacing/map2") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
    ["offset"] = Vec2(0, 0.5),
}

mtl1 = DwaSolidDielectricMaterial("/Scene/surfacing/mtl1") {
    ["albedo"] = bind(map1),
    ["roughness"] = 0.7,
}

mtl2 = DwaSolidDielectricMaterial("/Scene/surfacing/mtl2") {
    ["albedo"] = bind(map2),
    ["roughness"] = 0.7,
    ["thin_geometry"] = true,
}

mtlWall = DwaSolidDielectricMaterial("/Scene/surfacing/wall") {
    ["albedo"] = Rgb(0.5, 0.5, 0.6),
    ["roughness"] = 0.7,
}
-------------------------------------------------------

env = EnvLight("/Scene/lighting/env") {
    ["exposure"] = -1,
    ["texture"] = rats_assets_dir.."/hdri/parkinglot.exr"
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
}

Layer("/Scene/rendering/organizer/perPartitionAssignments") {
    {sphere1, "", mtl1, lightSet},
    {sphere2, "", mtl2, lightSet},
    {wall, "", mtlWall, lightSet}
}

RenderOutput("/output/beauty") {
    ["result"] = "beauty",
    ["file_name"] = "result.exr"
}
RenderOutput("/output/alpha") {
    ["result"] = "alpha",
    ["file_name"] = "result.exr"
}
RenderOutput("/output/depth") {
    ["result"] = "depth",
    ["file_name"] = "depth.exr"
}
RenderOutput("/output/material_albedo") {
    ["result"] = "material aov",
    ["file_name"] = "material.exr",
    ["material_aov"] = "DSS.albedo",
}
RenderOutput("/output/material_normal") {
    ["result"] = "material aov",
    ["file_name"] = "material.exr",
    ["material_aov"] = "DSS.normal",
}
RenderOutput("/output/state_N") {
    ["result"] = "state variable",
    ["file_name"] = "state.exr",
    ["state_variable"] = "N",
}
RenderOutput("/output/state_P") {
    ["result"] = "state variable",
    ["file_name"] = "state.exr",
    ["state_variable"] = "P",
}
