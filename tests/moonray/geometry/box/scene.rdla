rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["pixel_samples"] = 4,
    ["light_samples"] = 1,
    ["bsdf_samples"] = 1,
    ["bssrdf_samples"] = 0,
    ["max_depth"] = 3,
    ["russian_roulette_threshold"] = 0.0001,
    ["image_width"] = 512,
    ["image_height"] = 256,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = Mat4(0.996454, -0.0446502, -0.0713123, 0, 
                          0.00540735, 0.879804, -0.475306, 0, 
                          0.0839633, 0.473235, 0.876925, 0, 
                          3.51943, 18.4177, 33.7106, 1),
}

-------------------------------------------------------

box1 = BoxGeometry("/Scene/geometry/box1") {
    ["node_xform"] = rotate(90, 0, 1, 0) * rotate(20, 0, 0, 1) * translate(-6, 4, 4),
    ["size"] = Vec3(6, 5, 4),
}

box2 = BoxGeometry("/Scene/geometry/box2") {
    ["node_xform"] = rotate(-60, 0, 1, 0) * rotate(-50, 1, 0, 0) * translate(6, 6, 6),
    ["size"] = Vec3(9, 4, .5),
}

box3 = BoxGeometry("/Scene/geometry/box3") {
    ["node_xform"] = scale(3, 2, 1) * rotate(-10, 0, 1, 0) * translate(0, 1.5, 8),
    ["size"] = Vec3(1, 1, 1),
}

wall = RdlMeshGeometry("/Scene/geometry/wall") {
    ["node_xform"] = translate(0, 0, 0),
    ["vertex_list"] = {Vec3(-20,  20, -2), Vec3(-20,  0, -2), Vec3(-20,  0, 20),
                       Vec3(20,  0, 20), Vec3(20,  0, -2), Vec3(20,  20, -2)},
    ["vertices_by_index"] = {0, 1, 4, 5,
                             1, 2, 3, 4},
    ["face_vertex_count"] = {4, 4},
    ["is_subd"] = false,
    ["smooth_normal"] = false,
}

GeometrySet("geometryset") {
    box1,
    box2,
    box3,
    wall
}

-------------------------------------------------------

planeMap1 = ImageMap("/Scene/surfacing/planeMap1") {
    ["texture"] = rats_assets_dir .. "/textures/color_grid.tx",
}

planeMap2 = ImageMap("/Scene/surfacing/planeMap2") {
    ["texture"] = rats_assets_dir .. "/textures/color_grid.tx",
    ["offset"] = Vec2(0, 0.5),
}

baseMat1 = DwaBaseMaterial("/Scene/surfacing/base1") {
    ["albedo"] = bind(planeMap1),
    ["show_specular"] = false,
}

baseMat2 = DwaBaseMaterial("/Scene/surfacing/base2") {
    ["albedo"] = bind(planeMap2),
    ["show_specular"] = false,
}

wallMat = DwaBaseMaterial("/Scene/surfacing/wall") {
    ["albedo"] = Rgb(1, 1, 1),
    ["show_specular"] = false,
}

-------------------------------------------------------

env = EnvLight("/Scene/lighting/env") {
    ["intensity"] = 0.7,
    ["texture"] = rats_assets_dir .. "/hdri/parkinglot_dusk.exr",
}

key = RectLight("/Scene/lighting/key") {
    ["node_xform"] = translate(0, 0, 270) *
                     rotate(-40, 1, 0, 0) *
                     rotate(-60, 0, 1, 0),
    ["intensity"] = 5,
    ["normalized"] = false,
    ["color"] = Rgb(0.855, 0.77, 0.535),
    ["width"] = 80,
    ["height"] = 80,
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
    key,
}

Layer("/Scene/rendering/organizer/perPartitionAssignments") {
    {box1, "", baseMat1, lightSet},
    {box2, "", baseMat2, lightSet},
    {box3, "", baseMat2, lightSet},
    {wall, "", wallMat, lightSet}
}

