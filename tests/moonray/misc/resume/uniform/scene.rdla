rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 256,
    ["image_height"] = 213,
    ["sampling_mode"] = 0,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0, 0, 4.5) *
                     rotate(-29, 1, 0, 0) * rotate(0, 0, 1, 0) *
                     translate(0, 1.0, 0),
    ["focal"] = 35,
    ["film_width_aperture"] = 24,
}


env = EnvLight("/Scene/lighting/env") {
    ["node_xform"] = rotate(-90, 0, 1, 0),
    ["texture"] = rats_assets_dir.."/hdri/parkinglot.exr",
    ["exposure"] = -0.5,
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
}

planeGeom = RdlMeshGeometry("/Scene/geometry/planeGeom") {
    ["node_xform"] = scale(20, 1, 20),
    ["vertex_list"] = {Vec3(-0.5, 0.0, 0.5), Vec3(0.5, 0.0, 0.5), Vec3(0.5, 0.0, -0.5), Vec3(-0.5, 0.0, -0.5)},
    ["vertices_by_index"] = {0, 1, 2, 3},
    ["face_vertex_count"] = {4},
    ["is_subd"] = false
}

geom = SphereGeometry("/Scene/geometry/geom") {
    ["node_xform"] = translate(0, 1, 0),
}

GeometrySet("geometrySet") {
    planeGeom,
    geom,
}

planeMap = ImageMap("/Scene/surfacing/planeMap") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
    ["scale"] = Vec2(5, 5),
    ["wrap_around"] = true,
}

planeMtl = DwaSolidDielectricMaterial("/Scene/surfacing/planeMtl") {
    ["albedo"] = bind(planeMap),
    ["roughness"] = 0.4,
}

mtl = DwaSolidDielectricMaterial("/Scene/surfacing/mtl") {
    ["albedo"] = Rgb(0.319, 0.06, 0.0),
    ["roughness"] = 0.2,
}

Layer("layer") {
    { planeGeom, "", planeMtl, lightSet },
    { geom, "", mtl, lightSet },
}

RenderOutput("/output/alpha") {
   ["result"] = "alpha",
   ["channel_name"] = "alpha",
}

RenderOutput("/output/beauty") {
   ["result"] = "beauty",
   ["channel_name"] = "beauty",
   ["compression"] = "zip",
   ["channel_format"] = "float"
}

RenderOutput("/output/weight") {
   ["result"] = "weight",
   ["channel_name"] = "weight",
   ["compression"] = "zip",
   ["channel_format"] = "float"
}

RenderOutput("/output/beautyaux") {
   ["result"] = "beauty aux",
   ["channel_name"] = "beauty aux",
   ["compression"] = "zip",
   ["channel_format"] = "float"
}

RenderOutput("/output/alphaAux") {
   ["result"] = "alpha aux",
   ["channel_name"] = "alpha aux",
   ["compression"] = "zip",
   ["channel_format"] = "float"
}

ColorCorrectDisplayFilter("/display/exposure") {
    ["input"] = RenderOutput("/output/beauty"),
    ["exposure"] = -1,
}

RenderOutput("/output/exposure") {
    ["result"] = "display filter",
    ["display_filter"] = ColorCorrectDisplayFilter("/display/exposure"),
    ["channel_name"] = "exposure",
}
