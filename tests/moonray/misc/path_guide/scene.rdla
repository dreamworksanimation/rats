local md = 6
SceneVariables {
    ["image_width"] = 128,
    ["image_height"] = 128,
    ["max_depth"] = md,
    ["max_diffuse_depth"] = md,
    ["max_glossy_depth"] = md,
    ["max_mirror_depth"] = md,

    ["bsdf_samples"] = 1,
    ["light_samples"] = 1,

    ["sampling_mode"] = 2,
    ["min_adaptive_samples"] = 64,
    ["max_adaptive_samples"] = 4096,
    ["target_adaptive_error"] = 1,

    ["path_guide_enable"] = true,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0, 0, 26) *
                     rotate(-26, 1, 0, 0) * rotate(50, 0, 1, 0) *
                     translate(-0.4, 2, 0),
    ["focal"] = 35,
    ["film_width_aperture"] = 24,
}

geoms = {}
assignments = {}

-------------------------------------------------------

local key = SphereLight("/Scene/lighting/key") {
    ["node xform"] = translate(-15, 30, -25),
    ["color"] = Rgb(0.855, 0.77, 0.535),
    ["exposure"] = 4,
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    key,
}

-----------------------------------------------------

local planeGeom = RdlMeshGeometry("/Scene/geometry/planeGeom") {
    ["node_xform"] = scale(1000, 1, 1000),
    ["vertex_list"] = {Vec3(-0.5, 0.0, 0.5), Vec3(0.5, 0.0, 0.5), Vec3(0.5, 0.0, -0.5), Vec3(-0.5, 0.0, -0.5)},
    ["vertices_by_index"] = {0, 1, 2, 3},
    ["face_vertex_count"] = {4},
    ["is_subd"] = false
}
table.insert(geoms, planeGeom)

local planeMtl = DwaSolidDielectricMaterial("/Scene/surfacing/planeMtl") {
    ["albedo"] = Rgb(0.5, 0.5, 0.5),
    ["roughness"] = 0.03,
}
table.insert(assignments, {planeGeom, "", planeMtl, lightSet})

-------------------------------------------------------

local boxGeom = BoxGeometry("/Scene/geometry/box") {
    ["node_xform"] = scale(8, 8, 8) * translate(0, 4, 0),
}
table.insert(geoms, boxGeom)

local boxMtl = DwaRefractiveMaterial("Scene/surfacing/boxMtl") {
    ["casts_caustics"] = true,
    ["roughness"] = 0,
}
table.insert(assignments, {boxGeom, "", boxMtl, lightSet})

-------------------------------------------------------

local torusGeom = UsdGeometry("/Scene/geometry/torus") {
    ["node_xform"] = scale(3, 3, 3) * rotate(90, 0, 0, 1) * translate(0, 4, 0),
    ["stage"] = rats_assets_dir.."/models/torus.usdc",
    ["prim_path"] = "/torus",
}
table.insert(geoms, torusGeom)

local torusMtl = DwaSolidDielectricMaterial("Scene/surfacing/torusMtl") {
    ["albedo"] = Rgb(0.8, 0.8, 0.4),
}
table.insert(assignments, {torusGeom, "", torusMtl, lightSet})


-- table.insert(assignments, {geom, "base",        base_mtl, lightSet})
-- table.insert(assignments, {geom, "stand",       stand_mtl, lightSet})
-- table.insert(assignments, {geom, "shell_front", base_mtl, lightSet})
-- table.insert(assignments, {geom, "shell_back",  base_mtl, lightSet})
-- table.insert(assignments, {geom, "collar",      base_mtl, lightSet})
-- table.insert(assignments, {geom, "core",        core_mtl, lightSet})

-------------------------------------------------------

GeometrySet("Scene/geometrySet")(geoms)
Layer("/Scene/layer")(assignments)
