rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["pixel_samples"] = 1,
    ["camera"] = PerspectiveCamera("prim_attr_part_usd_main_cam"),
    ["image_width"] = 320,
    ["image_height"] = 240,
    ["deep_id_attribute_names"] = {"id"},
}

PerspectiveCamera("prim_attr_part_usd_main_cam") {
    ["node_xform"] = rotate(-12, 1, 0, 0) * rotate(38, 0, 1, 0) * translate(18, 16, 33),
}

--------------------------------------------------------------

ground_id = UserData("/ground_id") {
    ["float_key"] = "id",
    ["float_values"] = {0.7},
}

left_wall_id = UserData("/left_wall_id") {
    ["float_key"] = "id",
    ["float_values"] = {0.8},
}

right_wall_id = UserData("/right_wall_id") {
    ["float_key"] = "id",
    ["float_values"] = {0.9},
}

instance_id = UserData("/instance_id") {
    ["float_key"] = "instance_id",
    ["float_values"] = {1.0},
}

groundPlane = UsdGeometry("/ground") {
    ["node_xform"] = scale(50, 50, 50),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["part_list"] = { "ground" },
    ["primitive_attributes"] = { ground_id },
}

leftWallPlane = UsdGeometry("/leftWallPlane") {
    ["node_xform"] = rotate(90, 0, 0, 1) * scale(50, 50, 50) * translate(-25, 25, 0),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["part_list"] = { "ground" },
    ["primitive_attributes"] = { left_wall_id },
}

rightWallPlane = UsdGeometry("/rightWallPlane") {
    ["node_xform"] = rotate(90, 1, 0, 0) * scale(50, 50, 50) * translate(0, 25, -25),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["part_list"] = { "ground" },
    ["primitive_attributes"] = { right_wall_id },
}

--------------------------------------------------------------

widget_deep_ids = UserData("/widget_deep_ids") {
    ["float_key"] = "id",
    ["float_values_0"] = { 0.1, 0.2, 0.3, 0.4, 0.5, 0.6 },
    ["rate"] = "part"
}

widget = UsdGeometry("/obj/widget") {
    ["stage"] = rats_assets_dir .. "/models/MoonRayWidget.usdc",
    ["prim_path"] = "/widget",
    ["node_xform"] = rotate(35, 0, 1, 0) * scale(1.7, 1.7, 1.7) * translate(-5, 0, 0),
    ["part_list"] = {"stand", "shell_front", "shell_back", "core", "collar", "base" },
    ["primitive_attributes"] = { widget_deep_ids },
}

GeometrySet("/geometrySet") {
    widget,
    groundPlane,
    leftWallPlane,
    rightWallPlane,
}

--------------------------------------------------------------

mtl = DwaBaseMaterial("/mtl") {
    ["albedo"] = Rgb(0.7427, 0.7427, 0.7427),
}

rectLight = RectLight("/MoonrayRectLight") {
    ["node_xform"] = Mat4(0.739816, 0, -0.672809, 0, 
                         -0.399516, 0.804611, -0.439305, 0, 
                          0.541349, 0.593802, 0.595264, 0, 
                          9.24274, 14.3434, 5.18214, 1),
    ["exposure"] = -2,
    ["width"] = 10,
    ["height"] = 10,
}

lightSet = LightSet("/lightSet") {
    rectLight,
}

Layer("defaultLayer") {
    {widget, "", mtl, lightSet},
    {groundPlane, "", mtl, lightSet},
    {groundPlane, "ground", mtl, lightSet},
    {leftWallPlane, "", mtl, lightSet},
    {leftWallPlane, "ground", mtl, lightSet},
    {rightWallPlane, "", mtl, lightSet},
    {rightWallPlane, "ground", mtl, lightSet},
}

-------------------------------------------------------------

RenderOutput("RenderOutput::id") {
    ["result"] = 4,
    ["primitive_attribute"] = "id",
    ["channel_format"] = 0,
    ["math_filter"] = 3,
    ["file_name"] = "result0.exr",
    ["primitive_attribute_type"] = 0
}
