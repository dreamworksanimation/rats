rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

sceneVars = SceneVariables {
    ["cryptomatte_multi_presence"] = true
}

id0 = UserData("id0") {
    ["float_values"] = {0.1},
}

-- presence object without parts, to test whether multiple presence hits on the same id will count as 
-- multiple cryptomatte fragments
all_planes = RdlMeshGeometry("/Scene/geometry/all_planes") {
    ["node_xform"] = scale(1, 1, 1),
    ["vertex_list_0"] = { 
                            Vec3(-1.5,-1,-1), -- back square
                            Vec3( 0.5,-1,-1), 
                            Vec3(-1.5, 1,-1), 
                            Vec3( 0.5, 1,-1), 
                            Vec3(-1,-1, 0),   -- middle square
                            Vec3( 1,-1, 0), 
                            Vec3(-1, 1, 0), 
                            Vec3( 1, 1, 0), 
                            Vec3(-0.5,-1, 1), -- front square
                            Vec3( 1.5,-1, 1), 
                            Vec3(-0.5, 1, 1), 
                            Vec3( 1.5, 1, 1) 
                         },
    ["vertices_by_index"] = { 0,1,3,2,  4,5,7,6,  8,9,11,10},
    ["face_vertex_count"] = {4, 4, 4},
    ["is_subd"] = false,
    ["primitive_attributes"] = {id0},
}

GeometrySet("geometrySet") {
    all_planes,
}

overallpresence = 0.5

mtlR = DwaBaseMaterial("mtlR") { 
    ["albedo"] = Rgb(1, 0, 0), 
    ["presence"] = overallpresence 
}

Layer("layer") {
    { all_planes, "", mtlR, lightSet },
}

RenderOutput("cryptomatte") {
    ["cryptomatte_output_beauty"] = true,
    ["cryptomatte_output_normals"] = true,
    ["cryptomatte_output_positions"] = true,
    ["cryptomatte_depth"] = 8
}
