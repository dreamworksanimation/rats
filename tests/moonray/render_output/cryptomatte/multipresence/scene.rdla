
sceneVars = SceneVariables {
    ["cryptomatte_multi_presence"] = true
}

local id0 = UserData("id0") {
    ["float values"] = {0.1},
}

-- presence object without parts, to test whether multiple presence hits on the same id will count as 
-- multiple cryptomatte fragments
local all_planes = RdlMeshGeometry("/Scene/geometry/all_planes") {
    ["node xform"] = scale(1, 1, 1),
    ["vertex_list_0"]  = { 
                            Vec3(-1.5,-1,-1), -- back square
                            Vec3( 0.5,-1,-1), 
                            Vec3(-1.5, 1,-1), 
                            Vec3( 0.5, 1,-1), 
                            Vec3(-1,-1, 0),   -- middle square
                            Vec3( 1,-1, 0), 
                            Vec3(-1, 1, 0), 
                            Vec3( 1, 1, 0), 
                            Vec3(-0.5,-1, 1), -- front square
                            Vec3( 1.5,-1, 1), 
                            Vec3(-0.5, 1, 1), 
                            Vec3( 1.5, 1, 1) 
                         },
    ["vertices by index"] = { 0,1,3,2,  4,5,7,6,  8,9,11,10},
    ["face vertex count"] = {4, 4, 4},
    ["is subd"] = false,
    ["primitive attributes"] = {id0},
}

table.insert(geoms, all_planes)

-- Materials --

overallpresence = 0.5

local mtlR = DwaBaseMaterial("mtlR") { 
    ["albedo"] = Rgb(1, 0, 0), 
    ["presence"] = overallpresence 
}

table.insert(assignments, {all_planes, "", mtlR, lightSet})

GeometrySet("Scene/geometrySet")(geoms)
Layer("Scene/layer")(assignments)

RenderOutput("cryptomatte") {
    ["cryptomatte_output_beauty"] = true,
    ["cryptomatte_output_normals"] = true,
    ["cryptomatte_output_positions"] = true,
    ["cryptomatte_depth"] = 8
}