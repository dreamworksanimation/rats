rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables{
    ["image_width"] = 256,
    ["image_height"] = 256,
    ["pixel_samples"] = 4,
    ["light_samples"] = 1,
    ["bsdf_samples"] = 1,
    ["max_depth"] = 4,
    ["enable_presence_shadows"] = true,
}

Camera("camera") {
    ["node_xform"] = translate(-0.5, 0, 10) * rotate(-26, 1, 0, 0) * rotate(100, 0, 1, 0),
}

------------------------------------------------------------------------------

UsdGeometry("floor") {
    ["node_xform"] = scale(16, 1, 8),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

UsdGeometry("plane") {
    ["node_xform"] = translate(0, 0.8, 0) * scale(5, 2.3, 5) * translate(0, 0, 1.5),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
}

geoms = GeometrySet("geomset") {
    UsdGeometry("floor"),
    UsdGeometry("plane"),
}

------------------------------------------------------------------------------

ImageMap("colorGrid") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
}

DwaSolidDielectricMaterial("floorMtlB") {
    ["albedo"] = Rgb(0.8, 0.8, 0.8),
}

DwaSolidDielectricMaterial("presenceMtl") {
    ["albedo"] = Rgb(0.8, 0.0, 0.0),
    ["presence"] = bind(ImageMap("colorGrid"), 1),
}

------------------------------------------------------------------------------

rectLight = RectLight("rectlight") {
    ["node_xform"] = translate(0.0, 0.0, 100) *
                     rotate(-40, 1, 0, 0) *
                     rotate(-45, 0, 1, 0),
    ["color"] = Rgb(1, 1, 1),
    ["intensity"] = 10,
    ["width"] = 4, 
    ["height"] = 4,
    ["presence_shadows"] = 1
}

lights = LightSet("lights") {
    rectLight,
}

------------------------------------------------------------------------------

Layer("layer") {
    { UsdGeometry("floor"), "", DwaSolidDielectricMaterial("floorMtlB"), lights},
    { UsdGeometry("plane"), "", DwaSolidDielectricMaterial("presenceMtl"), lights},
}

