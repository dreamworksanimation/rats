rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables{
    ["image_width"] = 256,
    ["image_height"] = 256,
    ["pixel_samples"] = 4,
    ["max_depth"] = 8,
    ["transparency_threshold"] = 0.45,
}

Camera("camera") {
    ["node_xform"] = rotate(-30, 1, 0, 0) * translate(0, 5, 10),
}

------------------------------------------------------------------------------

UsdGeometry("floorB") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(20, 1, 20) * translate(0, 0, 2),
}

UsdGeometry("sheet0") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, -1),
}

UsdGeometry("sheet1") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 0),
}

UsdGeometry("sheet2") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 1),
}

UsdGeometry("sheet3") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 2),
}

UsdGeometry("sheet4") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 3),
}

UsdGeometry("sheet5") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 4),
}

UsdGeometry("sheet6") {
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["node_xform"] = scale(2, 2, 2) * rotate(90, 1, 0, 0) * translate(0, 0.5, 5),
}

geoms = GeometrySet("geomset") {
    UsdGeometry("floorB"),
    UsdGeometry("sheet0"),
    UsdGeometry("sheet1"),
    UsdGeometry("sheet2"),
    UsdGeometry("sheet3"),
    UsdGeometry("sheet4"),
    UsdGeometry("sheet5"),
    UsdGeometry("sheet6"),
}

------------------------------------------------------------------------------

DwaSolidDielectricMaterial("floorMtl") {
    ["albedo"] = Rgb(0.6, 0.6, 0.6),
}

DwaRefractiveMaterial("mtlTransmission") {
    ["refractive_index"] = 1.0,
    ["transmission_color"] = Rgb(0.8, 0.8, 0.8),
}

------------------------------------------------------------------------------

rectLight = RectLight("rectlight") {
    ["node_xform"] = Mat4(-1.03527617, 0, 3.86370325, 0,
                          1.93185163, 3.46410155, 0.517638087, 0,
                          -3.34606528, 2, -0.896575451, 0,
                          -68, 40, -21, 1),
    ["color"] = Rgb(1, 1, 1),
    ["intensity"] = 10,
    ["width"] = 1,
    ["height"] = 1,
}

rig = LightSet("rig") {
    rectLight,
}

Layer("layer") {
    {UsdGeometry("floorB"), "", DwaSolidDielectricMaterial("floorMtl"), rig},
    {UsdGeometry("sheet0"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet1"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet2"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet3"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet4"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet5"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
    {UsdGeometry("sheet6"), "", DwaRefractiveMaterial("mtlTransmission"), rig},
}
