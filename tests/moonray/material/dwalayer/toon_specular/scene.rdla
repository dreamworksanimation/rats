rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 550,
    ["image_height"] = 130,
    ["pixel_samples"] = 3,
}

PerspectiveCamera("/interactive/camera") {
    ["node_xform"] = translate(0, 0, 13),
}

--------------------- LIGHTS ---------------------------

envlight = EnvLight("envlight") {
    ["intensity"] = 0.5,
    ["sample_upper_hemisphere_only"] = true,
}

rectLight = RectLight("rectLight") {
    ["node_xform"] = translate(0, 0, 30) * 
                     rotate(15.0, 0, 1, 0) * 
                     rotate(-45.0, 1, 0, 0),
    ["width"] = 0.1,
    ["height"] = 0.1,
    ["intensity"] = 1.0,
    ["visible_in_camera"] = 1,
}

lightset = LightSet("/Scene/lightset") {
    envlight,
    rectLight,
}

-------------------- GEOMETRY ---------------------------

planeGeom = UsdGeometry("planeGeom") {
    ["node_xform"] = rotate(90, 1, 0, 0) * 
                     scale(25.0, 25.0, 25.0) * 
                     translate(0.0, 0.0, -5.0),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane"
}

x_offset = -1.25

sphere0Geom = SphereGeometry("sphere0Geom") {
    ["node_xform"] = translate(x_offset + 0.0, 0, 0),
}

sphere1Geom = SphereGeometry("sphere1Geom") {
    ["node_xform"] = translate(x_offset + -2.5, 0, 0),
}

sphere2Geom = SphereGeometry("sphere2Geom") {
    ["node_xform"] = translate(x_offset + 2.5, 0, 0),
}

sphere3Geom = SphereGeometry("sphere3Geom") {
    ["node_xform"] = translate(x_offset + 5.0, 0, 0),
}

GeometrySet("/Scene/geoset") {
    planeGeom,
	sphere0Geom,
	sphere1Geom,
	sphere2Geom,
	sphere3Geom,
}

-------------------- MATERIALS ---------------------------

planeMap = ImageMap("planeMap") {
    ["texture"] = rats_assets_dir .. "/textures/color_grid.tx",
    ["scale"] = Vec2(5.0, 5.0),
    ["offset"] = Vec2(0.0, 0.0),
    ["wrap_around"] = true,
}

planeMtl = DwaBaseMaterial("planeMtl") {
    ["albedo"] = bind(planeMap),
    ["show_specular"] = false,
}

toonMtl0 = DwaToonMaterial("toonMtl0") {
    ["diffuse_model"] = "oren-nayar",
    ["albedo"] = Rgb(0.0, 0.1, 0.1),
    ["specular_model"] = "Toon",
    ["roughness"] = 0.35,

    ["show_specular"] = true,
    ["toon_specular_intensity"] = 1.0,
    ["toon_specular_fresnel_blend"] = 0.5,
    ["toon_specular_interpolations"] = {0, 0, 0, 0},
    ["toon_specular_positions"] = {0.0, 0.33, 0.66, 1.0},
    ["toon_specular_values"] = {1.0, 0.75, 0.25, 0.0},
    ["toon_specular_ramp_input_scale"] = 0.5,
    ["refractive_index"] = 1.05,
}

toonMtl1 = DwaToonMaterial("toonMtl1") {
    ["diffuse_model"] = "ramp",
    ["albedo"] = Rgb(0.5, 0.0, 0.0),
    ["interpolations"] = {0, 0, 0, 0, 0},
    ["positions"] = {0, 0.25, 0.5, 0.75, 1},
    ["colors"] = {
        Rgb(1.0, 1.0, 1.0),
        Rgb(0.75, 0.75, 0.75),
        Rgb(0.5, 0.5, 0.5),
        Rgb(0.25, 0.25, 0.25),
        Rgb(0.0, 0.0, 0.0),
    },

    ["show_specular"] = true,
    ["specular_model"] = "GGX",
    ["roughness"] = 0.2,
}

sdMtl = DwaSolidDielectricMaterial("sdMtl") {
    ["albedo"] = Rgb(0.5, 0.0, 0.0),
    ["roughness"] = 0.3,
}

rfMtl = DwaRefractiveMaterial("rfMtl") {
    ["refractive_index"] = 1.05,
    ["roughness"] = 0.05,
}

metalMtl = DwaMetalMaterial("metalMtl") {
    ["metallic_color"] = Rgb(1.0, 0.0, 0.0),
}

noiseMap = NoiseMap_v2("noiseMap") {
    ["space"] = "world",
    ["frequency_multiplier"] = 3,
    ["use_smoothstep"] = true,
    ["smoothstep"] = Vec2(0.4, 0.6),
    ["max_level"] = 3,
}

lyrMtl0 = DwaLayerMaterial("layerMtl0") {
    ["material_A"] = toonMtl0,
    ["material_B"] = sdMtl,
    ["mask"] = bind(noiseMap),
}

lyrMtl1 = DwaLayerMaterial("layerMtl1") {
    ["material_A"] = rfMtl,
    ["material_B"] = toonMtl0,
    ["mask"] = bind(noiseMap),
}

lyrMtl2 = DwaLayerMaterial("layerMtl2") {
    ["material_A"] = toonMtl0,
    ["material_B"] = metalMtl,
    ["mask"] = bind(noiseMap),
}

lyrMtl3 = DwaLayerMaterial("layerMtl3") {
    ["material_A"] = toonMtl1,
    ["material_B"] = toonMtl0,
    ["mask"] = bind(noiseMap),
}

Layer("/Scene/layer") {
    {planeGeom,    {""}, planeMtl, lightset},
    {sphere0Geom,  {""}, lyrMtl0,  lightset},
    {sphere1Geom,  {""}, lyrMtl1,  lightset},
    {sphere2Geom,  {""}, lyrMtl2,  lightset},
    {sphere3Geom,  {""}, lyrMtl3,  lightset},
}
