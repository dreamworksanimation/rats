rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 256,
    ["image_height"] = 230,
    ["pixel_samples"] = 1,
    ["max_depth"] = 6,
    ["max_mirror_depth"] = 6,
    ["max_glossy_depth"] = 6,
    ["max_presence_depth"] = 6,
    ["russian_roulette_threshold"] = 0,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0.6, -0.5, 4) *
                     rotate(-90, 1, 0, 0) *
                     translate(0, 2, 0),
}

-------------------------------------------------------

env = EnvLight("/Scene/lighting/env") {
    ["intensity"] = 0.8,
    ["exposure"] = 0.0,
    ["texture"] = rats_assets_dir .. "/hdri/parkinglot_dusk.exr",
}

key = RectLight("/Scene/lighting/key") {
    ["node_xform"] = translate(0, 0, 100) *
                     rotate(-60, 1, 0, 0) *
                     rotate(-60, 0, 1, 0),
    ["intensity"] = 12,
    ["exposure"] = 0.0,
    ["color"] = Rgb(0.855, 0.77, 0.535),
    ["width"] = 50,
    ["height"] = 50,
    ["presence_shadows"] = 1,
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
    key,
}

-------------------------------------------------------

local plane_width = 40
local plane_depth = 40
local checker_size = 12.0

local planeGeom = UsdGeometry("/Scene/geometry/planeGeom") {
    ["node_xform"] = scale(0.5 * plane_width, 1, 0.5 * plane_depth),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane"
}

local planeMap = ImageMap("/Scene/surfacing/planeMap") {
    ["texture"] = rats_assets_dir .. "/textures/color_grid.tx",
    ["scale"] = Vec2(plane_width / checker_size, plane_depth / checker_size),
    ["offset"] = Vec2(-0.5 * plane_width / checker_size,
                      -0.5 * plane_depth / checker_size),
    ["wrap_around"] = true,
}

local planeMtl = DwaBaseMaterial("/Scene/surfacing/planeMtl") {
    ["albedo"] = bind(planeMap),
    ["show_specular"] = false,
}

-------------------------------------------------------

local redgeom = SphereGeometry("/Scene/geometry/redgeom") {
    ["node_xform"] = translate(0.625, 1.5, 1.0),
}

local greengeom = SphereGeometry("/Scene/geometry/greengeom") {
    ["node_xform"] = translate(1.25, 1.5, 0),
}

local bluegeom = SphereGeometry("/Scene/geometry/bluegeom") {
    ["node_xform"] = translate(0, 1.5, 0),
}

local redmtl = DwaRefractiveMaterial("red glass") {
    ["priority"] = 3,
    ["refractive_index"] = 2.4,
    ["transmission_color"] = Rgb(1, 0.5, 0.5),
    ["roughness"] = 0.01,
    ["specular_model"] = 0,
    ["casts_caustics"] = true,
}

local greenmtl = DwaRefractiveMaterial("green glass") {
    ["priority"] = 2,
    ["refractive_index"] = 1.33,
    ["transmission_color"] = Rgb(0.5, 1, 0.5),
    ["roughness"] = 0.01,
    ["specular_model"] = 0,
    ["casts_caustics"] = true,
}

local bluemtl = DwaRefractiveMaterial("blue glass") {
    ["priority"] = 1,
    ["refractive_index"] = 1.5,
    ["transmission_color"] = Rgb(0.5, 0.5, 1),
    ["roughness"] = 0.01,
    ["specular_model"] = 0,
    ["casts_caustics"] = true,
}

-------------------------------------------------------

GeometrySet("Scene/geometrySet") {
    planeGeom,
    redgeom,
    greengeom,
    bluegeom
}

Layer("/Scene/layer") {
    {planeGeom, "", planeMtl, lightSet},
    {redgeom, "", redmtl, lightSet},
    {greengeom, "", greenmtl, lightSet},
    {bluegeom, "", bluemtl, lightSet},
}
