rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["pixel_samples"] = 1,
    ["image_width"] = 500,
    ["image_height"] = 250,
    ["lights_visible_in_camera"] = true,
    ["max_depth"] = 0,
}

shotCam = Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0,0,6),
    ["focal"] = 30,
}

-------------------------------------------------------
-- Lights

key2 = RectLight("key2") {
    ["node_xform"] = rotate(-90, 0,1,0) * translate(-50, 10, 0) * rotate(-18, 0, 0, 1) * rotate(120, 0, 1, 0),
    ["exposure"] = 21,
    ["normalized"] = false,
    ["color"] = Rgb(1, 0.7, 0.4),
    ["width"] = 0.1,
    ["height"] = 0.1,
    ["visible_in_camera"] = 1,
}

lightSet = LightSet("MyLightSet") {
    key2,
}

skin = ImageMap("skin") {
    ["texture"] = rats_assets_dir .. "/textures/skin.tx"
}
--
-------------------------------------------------------
-- Plane facing away from camera
planeGeomFacingAway = UsdGeometry("planeGeomFacingAway") {
    ["node_xform"] = rotate(90, 1, 0, 0) * rotate(225, 0, 1, 0) * translate(-1, 0, 1),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["side_type"] = "force two-sided",
}

-------------------------------------------------------
-- Plane facing camera
planeGeomFacingFront = UsdGeometry("planeGeomFacingFront") {
    ["node_xform"] = rotate(90, 1, 0, 0) * rotate(45, 0, 1, 0) * translate(0, 0, 1),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
    ["side_type"] = "force single-sided",
}

-------------------------------------------------------
-- Box with thickness
boxGeom = BoxGeometry("boxGeom") {
    ["node_xform"] = scale(1, 1, 0.01) * rotate(45, 0, 1, 0) * translate(1, 0, 1),
}

-------------------------------------------------------
-- shadow casters
shadowGeom1 = BoxGeometry("shadowGeom1") {
    ["node_xform"] = scale(10, 0.2, 0.01) * rotate(45, 0, 1, 0) * translate(0.4, 2, 5.7),
}

-------------------------------------------------------
-- Materials
scatteringRadius = 0.5
scatteringColor = Rgb(0.5, 0.025, 0.02)

thinGeometryMtl = DwaSkinMaterial("thinGeometryMtl") {
    ["albedo"] = bind(skin),
    ["show_specular"] = false,
    ["scattering_radius"] = scatteringRadius,
    ["scattering_color"] = scatteringColor,
    ["thin_geometry"] = false,
}

thickGeometryMtl = DwaSkinMaterial("thickGeometryMtl") {
    ["albedo"] = bind(skin),
    ["show_specular"] = false,
    ["scattering_radius"] = scatteringRadius,
    ["scattering_color"] = scatteringColor,
    ["thin_geometry"] = false,
}

shadowy = DwaEmissiveMaterial("shadowy") {
    ["emissive"] = Rgb(0,1,0),
}

-------------------------------------------------------
-- Assignments

GeometrySet("Scene/geometrySet") {
    planeGeomFacingAway,
    planeGeomFacingFront,
    boxGeom,
    shadowGeom1,
}
Layer("/Scene/layer") {
    {planeGeomFacingAway, "", thinGeometryMtl, lightSet},
    {planeGeomFacingFront, "", thinGeometryMtl, lightSet},
    {boxGeom, "", thickGeometryMtl, lightSet},
    {shadowGeom1, "", shadowy, lightSet},
}

RenderOutput("RO_wireframe") {
    ["result"] = "wireframe",
}
