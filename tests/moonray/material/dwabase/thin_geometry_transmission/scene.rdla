rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 512,
    ["image_height"] = 256,
}

EnvLight("/lights/env") {
    ["color"] = Rgb(0.4, 0.75, 1.0),
    ["exposure"] = -2,
    ["visible_in_camera"] = 1,
}

RectLight("/lights/rect") {
    ["width"] = 50,
    ["height"] = 100,
    ["normalized"] = false,
    ["exposure"] = 2.3,
    ["node_xform"] = rotate(-90, 1, 0, 0) * translate(-38, 70, -60),
    ["visible_in_camera"] = 1,
}

LightSet("/light_sets/lights") {
    EnvLight("/lights/env"),
    RectLight("/lights/rect"),
}

PerspectiveCamera("/cameras/persp") {
    ["node_xform"] = rotate(-34, 1, 0, 0) * rotate(18, 0, 1, 0)* translate(10, 23, 28),
}

UsdGeometry("/geometry/ground_plane") {
    ["node_xform"] = scale(200, 1, 200),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
}

UsdGeometry("/geometry/plane1") {
    ["node_xform"] = scale(10, 1.0, 10) * translate(-6, 5, 0),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
}

UsdGeometry("/geometry/plane2") {
    ["node_xform"] = scale(10, 1.0, 10) * translate(6, 5, 0),
    ["stage"] = rats_assets_dir .. "/models/plane.usdc",
    ["prim_path"] = "/plane",
}

GeometrySet("/geometry_sets/geometry") {
    UsdGeometry("/geometry/ground_plane"),
    UsdGeometry("/geometry/plane1"),
    UsdGeometry("/geometry/plane2"),
}

local graph_scale = 64

ImageMap("/maps/graph_paper") {
    ["texture"] = rats_assets_dir .. "/textures/graphpaper.tx",
    ["scale"] = Vec2(graph_scale, graph_scale),
}
DwaSolidDielectricMaterial("/materials/graph_paper") {
    ["albedo"] = bind(ImageMap("/maps/graph_paper")),
}

DwaRefractiveMaterial("/materials/glass_thick") {
    ["transmission_color"] = Rgb(1.0, 0.25, 0.25),
    ["roughness"] = 0.01,
    ["casts_caustics"] = true,
}

DwaRefractiveMaterial("/materials/glass_thin") {
    ["transmission_color"] = Rgb(1.0, 0.125, 0.125),
    ["roughness"] = 0.01,
    ["casts_caustics"] = true,
    ["thin_geometry"] = true,
}

Layer("/layers/Layer") {
    {UsdGeometry("/geometry/ground_plane"), "", DwaSolidDielectricMaterial("/materials/graph_paper"), LightSet("/light_sets/lights")},
    {UsdGeometry("/geometry/plane1"), "", DwaRefractiveMaterial("/materials/glass_thick"), LightSet("/light_sets/lights")},
    {UsdGeometry("/geometry/plane2"), "", DwaRefractiveMaterial("/materials/glass_thin"), LightSet("/light_sets/lights")},
}

