SceneVariables {
    ["image_width"] = 500,
    ["image_height"] = 300,
    ["pixel_samples"] = 3,
    ["max_depth"] = 9,
    ["lights_visible_in_camera"] = true,
    ["russian_roulette_threshold"] = 0,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0, 1, 55) * rotate(-66, 1, 0, 0),
    ["focal"] = 50,
}

geoms = {}
assignments = {}

-------------------------------------------------------

env = EnvLight("/Scene/lighting/env") {
    ["exposure"] = -1,
    ["visible_in_camera"] = 1,  -- Int, enumerable (use default)
    ["texture"] = rats_assets_dir .. "/hdri/parkinglot_dusk.exr",
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
}

-------------------------------------------------------
--make a 7x9 grid of spheres

X_START = -9                                        -- x-value of the leftmost sphere
X_NUM_SPHERES = 7                                   -- number of spheres in a row
X_OFFSET = 3                                        -- space between spheres in a row
x_end = X_START + (X_OFFSET * (X_NUM_SPHERES-1))    -- x-value of the rightmost sphere

Y_START = 12.5                                      -- y-value of the topmost sphere
Y_NUM_SPHERES = 9                                   -- number of spheres in a column
Y_OFFSET = -4                                       -- space between spheres in a row
y_end = Y_START + (Y_OFFSET * (Y_NUM_SPHERES-1))    -- y-value of the bottom-most sphere

local i = 1
for y = Y_START, y_end, Y_OFFSET do
for x = X_START, x_end, X_OFFSET do

    local geom = SphereGeometry("geom"..i) {
        ["node_xform"] = translate(x, y, 0),
    }
    table.insert(geoms, geom)
    i = i +1
    -- print(i, x, y)
end
end

------- these are the uncorrected materials across the top row ---------

local metal = DwaMetalMaterial("metal") {
    ["roughness"] = 0.1,
    ["specular_model"] = 0,
    ["metallic_color"] = Rgb(0.966, 0.829, 0.438),
    ["metallic_edge_color"] = Rgb(0.366, 0.429, 0.938),
}
local plastic = DwaSolidDielectricMaterial("plastic") {
    ["albedo"] = Rgb(0.02, 0.02, 0.65),
    ["roughness"] = 0.2,
    ["specular_model"] = 0,
}
local fuzzy = DwaSolidDielectricMaterial("fuzzy") {
    ["albedo"] = Rgb(0.04, 0.04, 0.04),
    ["show_fuzz"] = true,
    ["fuzz"] = 1,
    ["fuzz_albedo"] = Rgb(0.8, 0.5, 0.3),
    ["fuzz_roughness"] = 0.5,
    ["specular_model"] = 0,
}
local fabric = DwaFabricMaterial("fabric") {
    ["use_independent_weft_attributes"] = true,
    ["warp_color"] = Rgb(1, 0.1, 0.1),
    ["warp_roughness"] = 0.75,
    ["warp_thread_coverage"] = 0.75,
    ["weft_color"] = Rgb(0.1, 1, 0.1),
    ["weft_roughness"] = 0.75,
}
local refractive = DwaRefractiveMaterial("refractive") {
    ["roughness"] = 0.001,
    ["specular_model"] = 0,
    ["transmission_color"] = Rgb(0.65, 0.05, 0.05),
}
local leaf = DwaSolidDielectricMaterial("leaf") {
    ["albedo"] = Rgb(0.02, 0.25, 0.1),
    ["roughness"] = 0.3,
    ["specular_model"] = 0,
    ["diffuse_transmission_blending_behavior"] = 1,
    ["diffuse_transmission_color"] = Rgb(0.05, 0.7, 0.05)
}
local glow = DwaSolidDielectricMaterial("glow") {
    ["show_diffuse"] = false,
    ["show_specular"] = false,
    ["show_emission"] = true,
    ["emission"] = Rgb(0.05, 0.7, 0.05)
}

-- test hue
local metal_cc1         = DwaColorCorrectMaterial("metal_cc1")         { ["input_material"] = metal,       ["hue_shift"] = 0.5, }
local plastic_cc1       = DwaColorCorrectMaterial("plastic_cc1")       { ["input_material"] = plastic,     ["hue_shift"] = 0.5, }
local fuzzy_cc1         = DwaColorCorrectMaterial("fuzzy_cc1")         { ["input_material"] = fuzzy,       ["hue_shift"] = 0.5, }
local fabric_cc1        = DwaColorCorrectMaterial("fabric_cc1")        { ["input_material"] = fabric,      ["hue_shift"] = 0.5, }
local refractive_cc1    = DwaColorCorrectMaterial("refractive_cc1")    { ["input_material"] = refractive,  ["hue_shift"] = 0.5, }
local leaf_cc1          = DwaColorCorrectMaterial("leaf_cc1")          { ["input_material"] = leaf,        ["hue_shift"] = 0.5, }
local glow_cc1          = DwaColorCorrectMaterial("glow_cc1")          { ["input_material"] = glow,        ["hue_shift"] = 0.5, }

-- test saturation
local metal_cc2         = DwaColorCorrectMaterial("metal_cc2")         { ["input_material"] = metal,       ["saturation"] = 0.1, }
local plastic_cc2       = DwaColorCorrectMaterial("plastic_cc2")       { ["input_material"] = plastic,     ["saturation"] = 0.1, }
local fuzzy_cc2         = DwaColorCorrectMaterial("fuzzy_cc2")         { ["input_material"] = fuzzy,       ["saturation"] = 0.1, }
local fabric_cc2        = DwaColorCorrectMaterial("fabric_cc2")        { ["input_material"] = fabric,      ["saturation"] = 0.1, }
local refractive_cc2    = DwaColorCorrectMaterial("refractive_cc2")    { ["input_material"] = refractive,  ["saturation"] = 0.1, }
local leaf_cc2          = DwaColorCorrectMaterial("leaf_cc2")          { ["input_material"] = leaf,        ["saturation"] = 0.1, }
local glow_cc2          = DwaColorCorrectMaterial("glow_cc2")          { ["input_material"] = glow,        ["saturation"] = 0.1, }

-- test gain
local metal_cc3         = DwaColorCorrectMaterial("metal_cc3")         { ["input_material"] = metal,       ["gain"] = 0.2, }
local plastic_cc3       = DwaColorCorrectMaterial("plastic_cc3")       { ["input_material"] = plastic,     ["gain"] = 0.2, }
local fuzzy_cc3         = DwaColorCorrectMaterial("fuzzy_cc3")         { ["input_material"] = fuzzy,       ["gain"] = 0.2, }
local fabric_cc3        = DwaColorCorrectMaterial("fabric_cc3")        { ["input_material"] = fabric,      ["gain"] = 0.2, }
local refractive_cc3    = DwaColorCorrectMaterial("refractive_cc3")    { ["input_material"] = refractive,  ["gain"] = 0.2, }
local leaf_cc3          = DwaColorCorrectMaterial("leaf_cc3")          { ["input_material"] = leaf,        ["gain"] = 0.2, }
local glow_cc3          = DwaColorCorrectMaterial("glow_cc3")          { ["input_material"] = glow,        ["gain"] = 0.2, }

-- test temerature +
local metal_cc4         = DwaColorCorrectMaterial("metal_cc4")         { ["input_material"] = metal,       ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local plastic_cc4       = DwaColorCorrectMaterial("plastic_cc4")       { ["input_material"] = plastic,     ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local fuzzy_cc4         = DwaColorCorrectMaterial("fuzzy_cc4")         { ["input_material"] = fuzzy,       ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local fabric_cc4        = DwaColorCorrectMaterial("fabric_cc4")        { ["input_material"] = fabric,      ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local refractive_cc4    = DwaColorCorrectMaterial("refractive_cc4")    { ["input_material"] = refractive,  ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local leaf_cc4          = DwaColorCorrectMaterial("leaf_cc4")          { ["input_material"] = leaf,        ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }
local glow_cc4          = DwaColorCorrectMaterial("glow_cc4")          { ["input_material"] = glow,        ["TMI_enabled"] = true, ["TMI"] = Rgb(4.0, 0.0, 0.0), }

-- test temperature -
local metal_cc5         = DwaColorCorrectMaterial("metal_cc5")         { ["input_material"] = metal,       ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local plastic_cc5       = DwaColorCorrectMaterial("plastic_cc5")       { ["input_material"] = plastic,     ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local fuzzy_cc5         = DwaColorCorrectMaterial("fuzzy_cc5")         { ["input_material"] = fuzzy,       ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local fabric_cc5        = DwaColorCorrectMaterial("fabric_cc5")        { ["input_material"] = fabric,      ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local refractive_cc5    = DwaColorCorrectMaterial("refractive_cc5")    { ["input_material"] = refractive,  ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local leaf_cc5          = DwaColorCorrectMaterial("leaf_cc5")          { ["input_material"] = leaf,        ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }
local glow_cc5          = DwaColorCorrectMaterial("glow_cc5")          { ["input_material"] = glow,        ["TMI_enabled"] = true, ["TMI"] = Rgb(-4.0, 0.0, 0.0), }

-- test magenta +
local metal_cc6         = DwaColorCorrectMaterial("metal_cc6")         { ["input_material"] = metal,       ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local plastic_cc6       = DwaColorCorrectMaterial("plastic_cc6")       { ["input_material"] = plastic,     ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local fuzzy_cc6         = DwaColorCorrectMaterial("fuzzy_cc6")         { ["input_material"] = fuzzy,       ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local fabric_cc6        = DwaColorCorrectMaterial("fabric_cc6")        { ["input_material"] = fabric,      ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local refractive_cc6    = DwaColorCorrectMaterial("refractive_cc6")    { ["input_material"] = refractive,  ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local leaf_cc6          = DwaColorCorrectMaterial("leaf_cc6")          { ["input_material"] = leaf,        ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }
local glow_cc6          = DwaColorCorrectMaterial("glow_cc6")          { ["input_material"] = glow,        ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 3.0, 0.0), }

-- test intensity +
local metal_cc7         = DwaColorCorrectMaterial("metal_cc7")         { ["input_material"] = metal,       ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local plastic_cc7       = DwaColorCorrectMaterial("plastic_cc7")       { ["input_material"] = plastic,     ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local fuzzy_cc7         = DwaColorCorrectMaterial("fuzzy_cc7")         { ["input_material"] = fuzzy,       ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local fabric_cc7        = DwaColorCorrectMaterial("fabric_cc7")        { ["input_material"] = fabric,      ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local refractive_cc7    = DwaColorCorrectMaterial("refractive_cc7")    { ["input_material"] = refractive,  ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local leaf_cc7          = DwaColorCorrectMaterial("leaf_cc7")          { ["input_material"] = leaf,        ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }
local glow_cc7          = DwaColorCorrectMaterial("glow_cc7")          { ["input_material"] = glow,        ["TMI_enabled"] = true, ["TMI"] = Rgb(0.0, 0.0, 4.0), }

-- test mix
local mix = 0.5
local metal_cc8         = DwaColorCorrectMaterial("metal_cc8")         { ["input_material"] = metal,       ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local plastic_cc8       = DwaColorCorrectMaterial("plastic_cc8")       { ["input_material"] = plastic,     ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local fuzzy_cc8         = DwaColorCorrectMaterial("fuzzy_cc8")         { ["input_material"] = fuzzy,       ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local fabric_cc8        = DwaColorCorrectMaterial("fabric_cc8")        { ["input_material"] = fabric,      ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local refractive_cc8    = DwaColorCorrectMaterial("refractive_cc8")    { ["input_material"] = refractive,  ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local leaf_cc8          = DwaColorCorrectMaterial("leaf_cc8")          { ["input_material"] = leaf,        ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }
local glow_cc8          = DwaColorCorrectMaterial("glow_cc8")          { ["input_material"] = glow,        ["TMI_enabled"] = true, ["TMI"] = Rgb(1.0, 2.0, 4.0), ["mix"] = mix, }

local gray = DwaSolidDielectricMaterial("gray") {
    ["albedo"] = Rgb(0.22, 0.22, 0.22),
    ["specular_model"] = 0,
}

local mtls = {
    metal,        plastic,       fuzzy,          fabric,        refractive,           leaf,           glow,
    metal_cc1,    plastic_cc1,   fuzzy_cc1,      fabric_cc1,    refractive_cc1,       leaf_cc1,       glow_cc1,     -- saturation
    metal_cc2,    plastic_cc2,   fuzzy_cc2,      fabric_cc2,    refractive_cc2,       leaf_cc2,       glow_cc2,     -- temperature +
    metal_cc3,    plastic_cc3,   fuzzy_cc3,      fabric_cc3,    refractive_cc3,       leaf_cc3,       glow_cc3,     -- temperature -
    metal_cc4,    plastic_cc4,   fuzzy_cc4,      fabric_cc4,    refractive_cc4,       leaf_cc4,       glow_cc4,     -- magenta +
    metal_cc5,    plastic_cc5,   fuzzy_cc5,      fabric_cc5,    refractive_cc5,       leaf_cc5,       glow_cc5,     -- magenta -
    metal_cc6,    plastic_cc6,   fuzzy_cc6,      fabric_cc6,    refractive_cc6,       leaf_cc6,       glow_cc6,     -- intensity +
    metal_cc7,    plastic_cc7,   fuzzy_cc7,      fabric_cc7,    refractive_cc7,       leaf_cc7,       glow_cc7,     -- intensity -
    metal_cc8,    plastic_cc8,   fuzzy_cc8,      fabric_cc8,    refractive_cc8,       leaf_cc8,       glow_cc8,     -- mix
}

for i,v in ipairs(mtls) do
    table.insert(assignments, {SphereGeometry("geom"..i), "",  mtls[i], lightSet})
end


-------------------------------------------------------

GeometrySet("Scene/geometrySet")(geoms)
Layer("/Scene/layer")(assignments)

