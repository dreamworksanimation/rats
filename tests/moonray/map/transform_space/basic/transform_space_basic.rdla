SceneVariables {
    ["image_width"] = 256 * 3,
    ["image_height"] = 256,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(7, 2, 32),
    ["focal"] = 50,
}

local cam2 = Camera("/Scene/rendering/camera2") {
    ["node_xform"] = translate(-1, 2, 32) * rotate(-70, 0, 1, 0),
    ["focal"] = 50,
}

-------------------------------------------------------

lightSet = LightSet("/Scene/lighting/lightSet") {
}

-------------------------------------------------------

geoms = {}
assignments = {}

-------------------------------------------------------

local attrPos = AttributeMap("/root/map/attrPos") {
    ["map_type"] = 1, -- position
}

local attrSt = AttributeMap("/root/map/attrSt") {
    ["map_type"] = 2, -- texture st
}

local tx = 0

for t=0,2 do -- type, 0=position, 1=vector, 2=normal
for y=0,4 do -- to space
for x=0,4 do -- from space
    attr = attrSt
    if t==0 and x == 1 and y == 3 then
        attr = attrPos
    end
    local map = TransformSpaceMap("/root/map/map_"..x..y..t) {
        ["input"] = bind(attr, Vec3(1, 1, 1)),
        ["input_type"] = t,
        ["from_space"] = x,
        ["to_space"] = y,
        ["camera"] = cam2,
    }
    local mtl = DwaEmissiveMaterial("/root/mtl/mtl_"..x..y..t) {
        ["emission"] = bind(map, Rgb(1,1,1)),
    }
    local geom = UsdGeometry("/root/geom/geom_"..x..y..t) {
        ["node_xform"] = rotate(90, 1, 0, 0) * translate(tx + x, y, 0),
        ["stage"] = "/usr/pic1/alee1/git/openmoonray/rats/assets/models/plane.usdc",
        ["prim_path"] = "/plane"
    }
    table.insert(geoms, geom)
    table.insert(assignments, {geom, "", mtl, lightSet})
end
end
    tx = tx + 5
end

-------------------------------------------------------

GeometrySet("Scene/geometrySet")(geoms)
Layer("/Scene/layer")(assignments)

