rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["pixel_samples"] = 3,
    ["max_depth"] = 3,
    ["image_width"] = 500,
    ["image_height"] = 175,
}

Camera("/Scene/rendering/camera") {
    ["node_xform"] = translate(0, 1.0, 17) * rotate(-10, 1, 0, 0),
    ["focal"] = 50,
}

-------------------------------------------------------

env = EnvLight("/Scene/lighting/env") {
    ["intensity"] = 0.8,
    ["texture"] = rats_assets_dir.."/hdri/parkinglot_dusk.exr",
}

key = RectLight("/Scene/lighting/key") {
    ["node_xform"] = translate(0, 0, 100) *
                     rotate(-60, 1, 0, 0) *
                     rotate(-60, 0, 1, 0),
    ["intensity"] = 12,
    ["color"] = Rgb(0.855, 0.77, 0.535),
    ["width"] = 50,
    ["height"] = 50,
}

lightSet = LightSet("/Scene/lighting/lightSet") {
    env,
    key,
}

-------------------------------------------------------

sphereLGeom = UsdGeometry("/Scene/geometry/sphereLGeom") {
    ["node_xform"] = rotate(180, 0, 1, 0) * translate(-2.6, 1.0, 0),
    ["stage"] = rats_assets_dir.."/models/sphere.usdc",
    ["prim_path"] = "/sphere",
}

sphereMGeom = UsdGeometry("/Scene/geometry/sphereMGeom") {
    ["node_xform"] = rotate(180, 0, 1, 0) * translate(0, 1.0, 0),
    ["stage"] = rats_assets_dir.."/models/sphere.usdc",
    ["prim_path"] = "/sphere",
}

sphereRGeom = UsdGeometry("/Scene/geometry/sphereRGeom") {
    ["node_xform"] = rotate(180, 0, 1, 0) * translate(2.6, 1.0, 0),
    ["stage"] = rats_assets_dir.."/models/sphere.usdc",
    ["prim_path"] = "/sphere",
}

planeGeom = UsdGeometry("/Scene/geometry/planeGeom") {
    ["node_xform"] = scale(18, 1, 10),
    ["stage"] = rats_assets_dir.."/models/plane.usdc",
    ["prim_path"] = "/plane"
}

GeometrySet("Scene/geometrySet") {
    sphereLGeom,
    sphereMGeom,
    sphereRGeom,
    planeGeom
}

---------------------------------------------------------

normalMap = ImageNormalMap("/Scene/surfacing/normalMap") {
    ["tangent_space_normal_texture"] = rats_assets_dir.."/textures/metal_anti_slip.tx",
    ["scale"] = Vec2(7, 7),
    ["rotation_angle"] = 90
}

sphereLMtl = DwaMetalMaterial("/Scene/surfacing/sphereLMtl") {
    ["metallic_color"] = Rgb(0.5, 0.5, 0.5),
    ["roughness"] = 0.7,
    ["input_normal"] = normalMap,
    ["anisotropy"] = 0.96,
}

sphereMMtl = DwaMetalMaterial("/Scene/surfacing/sphereMMtl") {
    ["metallic_color"] = Rgb(0.5, 0.5, 0.5),
    ["roughness"] = 0.2,
    ["input_normal"] = normalMap,
}

sphereRMtl = DwaMetalMaterial("/Scene/surfacing/sphereRMtl") {
    ["metallic_color"] = Rgb(0.5, 0.5, 0.5),
    ["roughness"] = 0.7,
    ["input_normal"] = normalMap,
    ["anisotropy"] = 0.96,
    ["shading_tangent"] = Vec2(0, 1),
}

planeMap = ImageMap("/Scene/surfacing/planeMap") {
    ["texture"] = rats_assets_dir.."/textures/color_grid.tx",
    ["scale"] = Vec2(7, 4),
    ["offset"] = Vec2(0, .25),
}

planeMtl = DwaBaseMaterial("/Scene/surfacing/planeMtl") {
    ["albedo"] = bind(planeMap),
    ["show_specular"] = false,
}

-------------------------------------------------------

Layer("/Scene/layer") {
    {sphereLGeom, "", sphereLMtl, lightSet},
    {sphereMGeom, "", sphereMMtl, lightSet},
    {sphereRGeom, "", sphereRMtl, lightSet},
    {planeGeom, "", planeMtl, lightSet}
}
