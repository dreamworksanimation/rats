rats_assets_dir = os.getenv("RATS_ASSETS_DIR")

SceneVariables {
    ["image_width"] = 250,
    ["image_height"] = 550,
    ["pixel_samples"] = 2,
}

shotCam = Camera("camera") {
    ["node_xform"] = translate(0, 0, 60),
    ["focal"] = 100,
}

lightSet = LightSet("lightSet") { }
geoms = {}
assignments = {}

numCol = 6 
numRow = 14 
spacingX = 2.4 
spacingY = 2.25
posXMin = -((numCol - 1) * spacingX) / 2.0
posYMax = ((numRow - 1)* spacingY) / 2.0

tx_px = rats_assets_dir .. "/textures/graphpaper.tx"
tx_py = rats_assets_dir .. "/textures/color_grid.tx"
tx_pz = rats_assets_dir .. "/textures/wood_splat.tx"
tx_nx = rats_assets_dir .. "/textures/graphpaper.tx"
tx_ny = rats_assets_dir .. "/textures/color_grid.tx"
tx_nz = rats_assets_dir .. "/textures/wood_splat.tx"

projGeom1 = BoxGeometry("projGeom1") {["node xform"] = scale(1.0, 1.0, 1.0)}
projGeom2 = BoxGeometry("projGeom2") {["node xform"] = scale(2.0, 2.0, 2.0)}
projGeom3 = BoxGeometry("projGeom3") {["node xform"] = scale(5.0, 5.0, 5.0)}

-- Generate a grid of widgets which are each assigned a unique ProjectTriplanarMap and DwaEmissiveMaterial.
-- These are named based on the row and column they occupy and are then referenced below individually to
-- test the various parameters.

posY = posYMax
for row = 1, numRow do
    posX = posXMin
    for col = 1, numCol do
        colT = col / numCol
        rowT = row / numRow
        
        if (col > 2) then
            nodeXform = rotate(135, 0, 1, 0) * rotate(-45, 1, 0, 0) * translate(posX, posY, 0)
        else
            nodeXform = rotate(-45, 0, 1, 0) * rotate(45, 1, 0, 0) * translate(posX, posY, 0)
        end

        geom = UsdGeometry("geom" .. row .. "-" .. col) {
            ["node_xform"] = nodeXform,
            ["stage"] = rats_assets_dir .. "/models/sphere.usdc",
            ["prim_path"] = "/sphere",
        }
        table.insert(geoms, geom)

        projTriMap = ProjectTriplanarMap("projTriMap-" .. row .. "-" .. col) {
           ["projector"] = projGeom1,
           ["use_reference_space"] = true,
           ["number_of_textures"] = "six",
           ["positive_x_texture"] = tx_px,
           ["positive_y_texture"] = tx_py,
           ["positive_z_texture"] = tx_pz,
           ["negative_x_texture"] = tx_nx,
           ["negative_y_texture"] = tx_ny,
           ["negative_z_texture"] = tx_nz,
        }

        mtl = DwaEmissiveMaterial("mtl-" .. row .. "-" .. col) {
            ["emission"] = bind(projTriMap, Rgb(1,1,1)),
        }
        table.insert(assignments, {geom, "", mtl, lightSet})

        posX = posX + spacingX 
    end
    posY = posY - spacingY
end

-- Each row (starting from the top) tests one parameter

-- Row 1 - invert_s
ProjectTriplanarMap("projTriMap-1-1") { ["positive_x_invert_s"] = true }
ProjectTriplanarMap("projTriMap-1-2") { ["positive_y_invert_s"] = true }
ProjectTriplanarMap("projTriMap-1-3") { ["positive_z_invert_s"] = true }
ProjectTriplanarMap("projTriMap-1-4") { ["negative_x_invert_s"] = true }
ProjectTriplanarMap("projTriMap-1-5") { ["negative_y_invert_s"] = true }
ProjectTriplanarMap("projTriMap-1-6") { ["negative_z_invert_s"] = true }

-- Row 2 - invert_t
ProjectTriplanarMap("projTriMap-2-1") { ["positive_x_invert_t"] = true }
ProjectTriplanarMap("projTriMap-2-2") { ["positive_y_invert_t"] = true }
ProjectTriplanarMap("projTriMap-2-3") { ["positive_z_invert_t"] = true }
ProjectTriplanarMap("projTriMap-2-4") { ["negative_x_invert_t"] = true }
ProjectTriplanarMap("projTriMap-2-5") { ["negative_y_invert_t"] = true }
ProjectTriplanarMap("projTriMap-2-6") { ["negative_z_invert_t"] = true }

-- Row 3 - offset
ProjectTriplanarMap("projTriMap-3-1") { ["positive_x_offset"] = Vec2(0.5, 0.5) }
ProjectTriplanarMap("projTriMap-3-2") { ["positive_y_offset"] = Vec2(0.5, 0.5) }
ProjectTriplanarMap("projTriMap-3-3") { ["positive_z_offset"] = Vec2(0.5, 0.5) }
ProjectTriplanarMap("projTriMap-3-4") { ["negative_x_offset"] = Vec2(0.5, 0.5) }
ProjectTriplanarMap("projTriMap-3-5") { ["negative_y_offset"] = Vec2(0.5, 0.5) }
ProjectTriplanarMap("projTriMap-3-6") { ["negative_z_offset"] = Vec2(0.5, 0.5) }

-- Row 4 - rotation
ProjectTriplanarMap("projTriMap-4-1") { ["positive_x_rotation"] = 45.0 }
ProjectTriplanarMap("projTriMap-4-2") { ["positive_y_rotation"] = 45.0 }
ProjectTriplanarMap("projTriMap-4-3") { ["positive_z_rotation"] = 45.0 }
ProjectTriplanarMap("projTriMap-4-4") { ["negative_x_rotation"] = 45.0 }
ProjectTriplanarMap("projTriMap-4-5") { ["negative_y_rotation"] = 45.0 }
ProjectTriplanarMap("projTriMap-4-6") { ["negative_z_rotation"] = 45.0 }

-- Row 5 - scale
ProjectTriplanarMap("projTriMap-5-1") { ["positive_x_scale"] = Vec2(2.0, 0.5) }
ProjectTriplanarMap("projTriMap-5-2") { ["positive_y_scale"] = Vec2(2.0, 0.5) }
ProjectTriplanarMap("projTriMap-5-3") { ["positive_z_scale"] = Vec2(2.0, 0.5) }
ProjectTriplanarMap("projTriMap-5-4") { ["negative_x_scale"] = Vec2(2.0, 0.5) }
ProjectTriplanarMap("projTriMap-5-5") { ["negative_y_scale"] = Vec2(2.0, 0.5) }
ProjectTriplanarMap("projTriMap-5-6") { ["negative_z_scale"] = Vec2(2.0, 0.5) }

-- Row 6 - swap_st
ProjectTriplanarMap("projTriMap-6-1") { ["positive_x_swap_st"] = true }
ProjectTriplanarMap("projTriMap-6-2") { ["positive_y_swap_st"] = true }
ProjectTriplanarMap("projTriMap-6-3") { ["positive_z_swap_st"] = true }
ProjectTriplanarMap("projTriMap-6-4") { ["negative_x_swap_st"] = true }
ProjectTriplanarMap("projTriMap-6-5") { ["negative_y_swap_st"] = true }
ProjectTriplanarMap("projTriMap-6-6") { ["negative_z_swap_st"] = true }

-- Row 7 - active
ProjectTriplanarMap("projTriMap-7-1") { ["positive_x_active"] = false }
ProjectTriplanarMap("projTriMap-7-2") { ["positive_y_active"] = false }
ProjectTriplanarMap("projTriMap-7-3") { ["positive_z_active"] = false }
ProjectTriplanarMap("projTriMap-7-4") { ["negative_x_active"] = false }
ProjectTriplanarMap("projTriMap-7-5") { ["negative_y_active"] = false }
ProjectTriplanarMap("projTriMap-7-6") { ["negative_z_active"] = false }

-- Row 8 - number_of_textures
ProjectTriplanarMap("projTriMap-8-1") { ["number_of_textures"] = "one" }
ProjectTriplanarMap("projTriMap-8-2") { ["number_of_textures"] = "three" }
ProjectTriplanarMap("projTriMap-8-3") { ["number_of_textures"] = "six" }
DwaEmissiveMaterial("mtl-8-4")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }
DwaEmissiveMaterial("mtl-8-5")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }
DwaEmissiveMaterial("mtl-8-6")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }

-- Row 9 - projector scale
ProjectTriplanarMap("projTriMap-9-1") { ["projector"] = projGeom1}
ProjectTriplanarMap("projTriMap-9-2") { ["projector"] = projGeom2}
ProjectTriplanarMap("projTriMap-9-3") { ["projector"] = projGeom3}
DwaEmissiveMaterial("mtl-9-4")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }
DwaEmissiveMaterial("mtl-9-5")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }
DwaEmissiveMaterial("mtl-9-6")        { ["emission"] = Rgb(0.0 ,0.0 ,0.0) }

-- Row 10 - randomize_flip 
ProjectTriplanarMap("projTriMap-10-1") { ["randomize_flip"] = true, ["random_seed"] = 1}
ProjectTriplanarMap("projTriMap-10-2") { ["randomize_flip"] = true, ["random_seed"] = 2}
ProjectTriplanarMap("projTriMap-10-3") { ["randomize_flip"] = true, ["random_seed"] = 3}
ProjectTriplanarMap("projTriMap-10-4") { ["randomize_flip"] = true, ["random_seed"] = 4}
ProjectTriplanarMap("projTriMap-10-5") { ["randomize_flip"] = true, ["random_seed"] = 5}
ProjectTriplanarMap("projTriMap-10-6") { ["randomize_flip"] = true, ["random_seed"] = 6}

-- Row 11 - randomize_offset 
ProjectTriplanarMap("projTriMap-11-1") { ["randomize_offset"] = true, ["random_seed"] = 1}
ProjectTriplanarMap("projTriMap-11-2") { ["randomize_offset"] = true, ["random_seed"] = 2}
ProjectTriplanarMap("projTriMap-11-3") { ["randomize_offset"] = true, ["random_seed"] = 3}
ProjectTriplanarMap("projTriMap-11-4") { ["randomize_offset"] = true, ["random_seed"] = 4}
ProjectTriplanarMap("projTriMap-11-5") { ["randomize_offset"] = true, ["random_seed"] = 5}
ProjectTriplanarMap("projTriMap-11-6") { ["randomize_offset"] = true, ["random_seed"] = 6}

-- Row 12 - randomize_rotation 
ProjectTriplanarMap("projTriMap-12-1") { ["randomize_rotation"] = true, ["random_seed"] = 1}
ProjectTriplanarMap("projTriMap-12-2") { ["randomize_rotation"] = true, ["random_seed"] = 2}
ProjectTriplanarMap("projTriMap-12-3") { ["randomize_rotation"] = true, ["random_seed"] = 3}
ProjectTriplanarMap("projTriMap-12-4") { ["randomize_rotation"] = true, ["random_seed"] = 4}
ProjectTriplanarMap("projTriMap-12-5") { ["randomize_rotation"] = true, ["random_seed"] = 5}
ProjectTriplanarMap("projTriMap-12-6") { ["randomize_rotation"] = true, ["random_seed"] = 6}

-- Row 13 - transition_width 
ProjectTriplanarMap("projTriMap-13-1") { ["transition_width"] = 0.0}
ProjectTriplanarMap("projTriMap-13-2") { ["transition_width"] = 0.25}
ProjectTriplanarMap("projTriMap-13-3") { ["transition_width"] = 0.5}
ProjectTriplanarMap("projTriMap-13-4") { ["transition_width"] = 0.75}
ProjectTriplanarMap("projTriMap-13-5") { ["transition_width"] = 1.0}
ProjectTriplanarMap("projTriMap-13-6") { ["transition_width"] = 1.0}

-- Row 14 - wrap_around 
ProjectTriplanarMap("projTriMap-14-1") { ["positive_x_scale"] = Vec2(0.5, 0.5), ["positive_x_wrap_around"] = false }
ProjectTriplanarMap("projTriMap-14-2") { ["positive_y_scale"] = Vec2(0.5, 0.5), ["positive_y_wrap_around"] = false }
ProjectTriplanarMap("projTriMap-14-3") { ["positive_z_scale"] = Vec2(0.5, 0.5), ["positive_z_wrap_around"] = false }
ProjectTriplanarMap("projTriMap-14-4") { ["negative_x_scale"] = Vec2(0.5, 0.5), ["negative_x_wrap_around"] = false }
ProjectTriplanarMap("projTriMap-14-5") { ["negative_y_scale"] = Vec2(0.5, 0.5), ["negative_y_wrap_around"] = false }
ProjectTriplanarMap("projTriMap-14-6") { ["negative_z_scale"] = Vec2(0.5, 0.5), ["negative_z_wrap_around"] = false }

GeometrySet("Scene/geometrySet")(geoms)
Layer("/Scene/layer")(assignments)

